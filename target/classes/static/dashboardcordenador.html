<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Coordenador SIGE</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: { primary: '#3b82f6', secondary: '#1e40af' },
        borderRadius: { 'button': '8px' }
      }
    }
  }
</script>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">

<!-- HEADER -->
<header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="font-['Pacifico'] text-4xl text-primary mb-2">SIGE</h1>
                        <p class="text-gray-600 text-lg font-medium">Sistema Integrado de Gest√£o de Est√°gio</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 flex items-center justify-center bg-primary rounded-full text-white">
                            <i class="ri-user-line text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Gabriel</p>
                            <p class="text-xs text-gray-500">Cordenador</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

<!-- NAV -->
<nav class="bg-white border-b border-gray-200">
  <div class="max-w-7xl mx-auto px-6">
    <div class="flex space-x-1">
      <button id="tab-ofertas" class="tab-button px-6 py-4 text-sm font-medium !rounded-button whitespace-nowrap bg-primary text-white">
        <i class="ri-briefcase-line mr-2"></i>Ofertas de Est√°gio
      </button>
      <button id="tab-perfil" class="tab-button px-6 py-4 text-sm font-medium !rounded-button whitespace-nowrap text-gray-600 hover:text-primary hover:bg-blue-50">
        <i class="ri-user-settings-line mr-2"></i>Meu Perfil
      </button>
      <button id="tab-gerenciar" class="tab-button px-6 py-4 text-sm font-medium !rounded-button whitespace-nowrap text-gray-600 hover:text-primary hover:bg-blue-50">
        <i class="ri-folder-open-line mr-2"></i>Gerenciar Est√°gios
      </button>
      <button id="tab-avaliacoes" class="tab-button px-6 py-4 text-sm font-medium !rounded-button whitespace-nowrap text-gray-600 hover:text-primary hover:bg-blue-50">
        <i class="ri-star-line mr-2"></i>Avalia√ß√µes
      </button>
      <button id="tab-cadastro" class="tab-button px-6 py-4 text-sm font-medium !rounded-button whitespace-nowrap text-gray-600 hover:text-primary hover:bg-blue-50">
  <i class="ri-user-add-line mr-2"></i>Cadastro
</button>
    </div>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-6 py-8">

  <!-- OFERTAS -->
  <section id="content-ofertas" class="tab-content">
    <div class="mb-6 flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-1">Ofertas de Est√°gio (todas)</h2>
        <p class="text-gray-600">Visualize todas as ofertas cadastradas na plataforma.</p>
      </div>
      <button id="btn-adicionar-oferta" class="bg-primary text-white px-4 py-2 rounded-button text-sm hover:bg-blue-600">Adicionar Oferta</button>
    </div>
    <div id="ofertas-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </section>

  <!-- PERFIL -->
  <section id="content-perfil" class="tab-content hidden">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-1">Meu Perfil</h2>
      <p class="text-gray-600">Altere suas informa√ß√µes de contato.</p>
    </div>
    <div class="bg-white rounded-md shadow-sm border border-gray-200 p-8">
      <form id="form-perfil" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
            <input id="input-nome" type="text" value="Coordenador SIGE" class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
            <input id="input-email" type="email" value="coordenador@sige.edu.br" class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
            <input id="input-telefone" type="tel" value="(11) 3000-4000" class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
            <input id="input-endereco" type="text" value="Rua Central, 100 - Centro" class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
          </div>
        </div>

        <div class="flex justify-end">
          <button type="submit" class="bg-primary text-white px-6 py-3 rounded-button text-sm hover:bg-blue-600">Salvar Altera√ß√µes</button>
        </div>
      </form>
    </div>
  </section>

  <!-- GERENCIAR ESTAGIOS -->
  <section id="content-gerenciar" class="tab-content hidden">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-1">Gerenciar Est√°gios</h2>
      <p class="text-gray-600">Veja todos os est√°gios da plataforma e gerencie candidatos.</p>
    </div>

    <div id="gerenciar-ofertas-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </section>

  <!-- AVALIACOES -->
  <section id="content-avaliacoes" class="tab-content hidden">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-1">Avalia√ß√µes</h2>
      <p class="text-gray-600">Avalia√ß√µes entre alunos e empresas (nota e coment√°rio).</p>
    </div>

    <div id="avaliacoes-list" class="space-y-4"></div>
  </section>

  <!-- CADASTRO -->
  <section id="content-cadastro" class="tab-content hidden">
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-1">Cadastro de Coordenador</h2>
    <p class="text-gray-600">Cadastre novos coordenadores na plataforma.</p>
  </div>

  <div class="bg-white rounded-md shadow-sm border border-gray-200 p-8">
    <form id="form-cadastro" class="space-y-6">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
          <input id="cadastro-nome" type="text" placeholder="Nome completo"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
          <input id="cadastro-cpf" type="text" placeholder="000.000.000-00"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
          <input id="cadastro-senha" type="password" placeholder="Senha de acesso"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <!-- EMAIL -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
          <input id="cadastro-email" type="email" placeholder="email@exemplo.com"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <!-- TELEFONE -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
          <input id="cadastro-telefone" type="text" placeholder="(00) 00000-0000"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <!-- ENDERE√áO -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
          <input id="cadastro-endereco" type="text" placeholder="Rua, n√∫mero, bairro, cidade"
            class="w-full px-4 py-3 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>
      </div>

      <div class="pt-4 flex justify-end">
        <button type="submit"
          class="px-6 py-3 bg-primary text-white font-medium rounded-md hover:bg-blue-600">
          Cadastrar Coordenador
        </button>
      </div>

    </form>
  </div>
</section>


</main>

<!-- MODAL: Detalhes / Candidatos -->
<div id="modal-detalhes" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg max-w-5xl w-full p-6">
    <div class="flex justify-between items-start">
      <h3 id="modal-titulo" class="text-xl font-semibold">Detalhes da Oferta</h3>
      <button id="btn-fechar-detalhes" class="text-gray-500 hover:text-gray-700"><i class="ri-close-line text-xl"></i></button>
    </div>
    <p id="modal-descricao" class="text-gray-700 mt-2"></p>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <h4 class="font-medium text-gray-700 mb-2">Inscritos</h4>
        <ul id="modal-inscritos" class="text-sm space-y-2"></ul>
      </div>
      <div>
        <h4 class="font-medium text-gray-700 mb-2">Aceitos</h4>
        <ul id="modal-aceitos" class="text-sm space-y-2"></ul>
      </div>
      <div>
        <h4 class="font-medium text-gray-700 mb-2">Ativos</h4>
        <ul id="modal-ativos" class="text-sm space-y-2"></ul>
      </div>
      <div>
        <h4 class="font-medium text-gray-700 mb-2">Finalizados</h4>
        <ul id="modal-finalizados" class="text-sm space-y-2"></ul>
      </div>
    </div>

    <div class="mt-4">
      <h4 class="font-medium text-gray-700 mb-2">Recusados</h4>
      <ul id="modal-recusados" class="text-sm space-y-2"></ul>
    </div>

    <div class="flex justify-end mt-4">
      <button id="btn-fechar-detalhes-2" class="px-4 py-2 border rounded-md hover:bg-gray-50">Fechar</button>
    </div>
  </div>
</div>

<!-- MODAL: Avalia√ß√£o (aluno avaliando empresa) -->
<div id="modal-avaliacao" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg max-w-lg w-full p-6">
    <h3 class="text-lg font-semibold mb-2">Avaliar Empresa</h3>
    <p id="empresa-avaliar" class="text-gray-700 mb-2"></p>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Nota:</label>
      <select id="nota-avaliacao" class="w-full border rounded-md p-2">
        <option value="1">1 ‚≠ê</option>
        <option value="2">2 ‚≠ê‚≠ê</option>
        <option value="3">3 ‚≠ê‚≠ê‚≠ê</option>
        <option value="4">4 ‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="5">5 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
      </select>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Coment√°rio:</label>
      <textarea id="comentario-avaliacao" rows="4" class="w-full border rounded-md p-2" placeholder="Escreva sua avalia√ß√£o..."></textarea>
    </div>
    <div class="flex justify-end gap-2">
      <button id="cancelar-avaliacao" class="px-4 py-2 border rounded-md hover:bg-gray-100">Cancelar</button>
      <button id="enviar-avaliacao" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-blue-600">Enviar</button>
    </div>
  </div>
</div>


<!-- SCRIPTS -->
<script>
  /* ---------- Dados mock (front-end) ---------- */

  let offers = []; // remove ou deixa vazio por enquanto
  fetch('http://localhost:8081/api/ofertas')
          .then(res => res.json())
          .then(data => {
            console.log('Dados da API:', data); // s√≥ para depurar
            offers = data.map(of => ({
              id: String(of.id),
              empresa: of.empresa.nome,
              descricao: of.descricaoVaga,
              candidatos: (of.candidaturas || []).map(c => ({
                nome: c.aluno.nome,
                email: c.aluno.email,
                telefone: c.aluno.telefone,
                status: c.status.toLowerCase(),
                id: String(c.id)
              }))
            }));

            console.log('Offers mapeadas:', offers); // ver se tudo certo
            function fullRefresh() {
              renderOffers();
              renderOffersWithActiveControls();
              renderAvaliacoes();
            }
            fullRefresh();
          })
          .catch(err => {
            console.error('Erro ao carregar ofertas:', err);
            initAll();
          });

  let avaliacoes = [];

  /* ---------- Helpers de render ---------- */
  const ofertasGrid = document.getElementById('ofertas-grid');
  const gerenciarGrid = document.getElementById('gerenciar-ofertas-grid');
  const avaliacoesList = document.getElementById('avaliacoes-list');

  function countByStatus(cands, status){
    return cands.filter(c=>c.status===status).length;
  }

function renderOffers(){
  // Render cards na aba Ofertas
  ofertasGrid.innerHTML = '';
  offers.forEach(of=>{
    const card = document.createElement('div');
    card.className = 'bg-white rounded-md shadow-sm border p-6 hover:shadow-md relative z-10';
    card.innerHTML = `
      <h3 class="text-lg font-semibold text-gray-900">${of.empresa}</h3>
      <p class="text-gray-600 text-sm my-3 line-clamp-3">${of.descricao}</p>
      <div class="flex items-center justify-between">
        <div class="text-sm text-gray-500">${of.candidatos.length} candidatos</div>
        <div class="flex gap-2">
          <button data-id="${of.id}" class="btn-ver-detalhes px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600">Ver Detalhes</button>
          <button data-id="${of.id}" class="btn-excluir px-3 py-1 text-red-500 border border-red-200 rounded-md hover:bg-red-50"><i class="ri-delete-bin-line"></i></button>
        </div>
      </div>
    `;
    ofertasGrid.appendChild(card);
  });

  // Render cards na aba Gerenciar Est√°gios
  gerenciarGrid.innerHTML = '';
  offers.forEach(of=>{
    const card = document.createElement('div');
    card.className = 'bg-white rounded-md shadow-sm border p-6 hover:shadow-md relative z-10';
    card.dataset.ofertaId = of.id;

    // build small lists text
    const aceitos = of.candidatos.filter(c=>c.status==='aceita').map(c=>c.nome);
    const ativos = of.candidatos.filter(c=>c.status==='ativo').map(c=>c.nome);
    const recusados = of.candidatos.filter(c=>c.status==='recusado').map(c=>c.nome);
    const inscritos = of.candidatos.filter(c=>c.status==='inscrito').map(c=>c.nome);
    const finalizados = of.candidatos.filter(c=>c.status==='finalizado').map(c=>c.nome);

    card.innerHTML = `
      <h3 class="text-lg font-semibold text-gray-900">${of.empresa}</h3>
      <p class="text-gray-600 text-sm my-2 line-clamp-3">${of.descricao}</p>
      <div class="space-y-2">
        <div class="text-sm text-gray-600">Inscritos: <span class="font-medium">${inscritos.length}</span></div>
        <div class="text-sm text-gray-600">Aceitos: <span class="font-medium">${aceitos.length}</span></div>
        <div class="text-sm text-gray-600">Ativos: <span class="font-medium">${ativos.length}</span></div>
        <div class="text-sm text-gray-600">Recusados: <span class="font-medium">${recusados.length}</span></div>
        <div class="text-sm text-gray-600">Finalizados: <span class="font-medium">${finalizados.length}</span></div>
      </div>
      <div class="mt-4 flex justify-between items-center">
        <button data-id="${of.id}" class="btn-ver-gerenciar px-3 py-1 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600">Ver / Gerenciar</button>
        <button data-id="${of.id}" class="btn-excluir px-3 py-1 text-red-500 border border-red-200 rounded-md hover:bg-red-50"><i class="ri-delete-bin-line"></i></button>
      </div>
    `;
    gerenciarGrid.appendChild(card);
  });
}

function renderAvaliacoes(){
  avaliacoesList.innerHTML = '';
  if(avaliacoes.length === 0){
    avaliacoesList.innerHTML = `<div class="bg-white p-6 rounded-md shadow-sm text-gray-500">Nenhuma avalia√ß√£o registrada.</div>`;
    return;
  }
  avaliacoes.forEach(a=>{
    const box = document.createElement('div');
    box.className = 'bg-white rounded-md shadow-sm border p-6';
    box.innerHTML = `
      <div class="flex justify-between items-start">
        <div>
          <h4 class="font-semibold">${a.aluno} ‚Üí ${a.empresa}</h4>
          <p class="text-sm text-gray-600 mt-1">Aluno: <span class="font-medium">${a.notaAluno} ‚≠ê</span></p>
          <p class="text-sm text-gray-700 mt-1">${a.comentarioAluno}</p>
        </div>
        <div class="text-right">
          <p class="text-sm text-gray-600">Empresa avaliou:</p>
          <p class="font-medium">${a.notaEmpresa ?? '‚Äî'} ‚≠ê</p>
          <p class="text-sm text-gray-700">${a.comentarioEmpresa ?? '‚Äî'}</p>
        </div>
      </div>
    `;
    avaliacoesList.appendChild(box);
  });
}

  /* ---------- Modal detalhes ---------- */
  const modalDetalhes = document.getElementById('modal-detalhes');
  const modalTitulo = document.getElementById('modal-titulo');
  const modalDescricao = document.getElementById('modal-descricao');
  const btnFecharDetalhes = document.getElementById('btn-fechar-detalhes');
  const btnFecharDetalhes2 = document.getElementById('btn-fechar-detalhes-2');
  let currentOfferId = null;

  // MODAL DETALHES atualizado para usar API real de candidatos
  async function openDetalhes(ofertaId){
    const of = offers.find(o=>o.id == ofertaId);
    console.log('Oferta aberta:', of);
    if(!of) return;
    currentOfferId = ofertaId;
    modalTitulo.textContent = `${of.empresa} ‚Äî Detalhes`;
    modalDescricao.textContent = of.descricao;

    await carregarCandidatos(ofertaId); // **Chamada da API real**

    modalDetalhes.classList.remove('hidden');
  }

  function closeDetalhes(){
    modalDetalhes.classList.add('hidden');
    currentOfferId = null;
  }

  /* ---------- Fun√ß√£o para carregar candidatos de API ---------- */
  async function carregarCandidatos(ofertaId) {
    const resp = await fetch(`http://localhost:8081/api/ofertas/${ofertaId}/candidatos`);
    const candidatos = await resp.json();

    const ulInscritos = document.getElementById("modal-inscritos");
    const ulAceitos = document.getElementById("modal-aceitos");
    const ulAtivos = document.getElementById("modal-ativos");
    const ulRecusados = document.getElementById("modal-recusados");
    const ulFinalizados = document.getElementById("modal-finalizados");

    ulInscritos.innerHTML = "";
    ulAceitos.innerHTML = "";
    ulAtivos.innerHTML = "";
    ulRecusados.innerHTML = "";
    ulFinalizados.innerHTML = "";

    candidatos.forEach(c => {
      const nome = c.aluno?.nome || "Nome n√£o informado";
      const email = c.aluno?.email || "Email n√£o informado";
      const telefone = c.aluno?.telefone || "Telefone n√£o informado";
      const status = c.status.toUpperCase();
      const id = c.id;

      const li = document.createElement("li");
      li.className = "flex justify-between items-center bg-gray-100 p-2 rounded-md";

      // üîπ Define os bot√µes conforme o status
      let botoesHTML = '';
      if (status === "INSCRITO") {
        botoesHTML = `
        <button class="px-2 py-1 bg-blue-500 text-white text-xs rounded-md hover:bg-blue-600 btn-aceitar">Aceitar</button>
        <button class="px-2 py-1 bg-red-500 text-white text-xs rounded-md hover:bg-red-600 btn-recusar">Recusar</button>
      `;
      } else if (status === "ACEITA") {
        botoesHTML = `
        <button class="px-2 py-1 bg-green-500 text-white text-xs rounded-md hover:bg-green-600 btn-aceitar">Iniciar Est√°gio</button>
        <button class="px-2 py-1 bg-red-500 text-white text-xs rounded-md hover:bg-red-600 btn-recusar">Recusar</button>
      `;
      } else if (status === "ATIVO") {
        botoesHTML = `
        <button class="px-2 py-1 bg-yellow-500 text-white text-xs rounded-md hover:bg-yellow-600 btn-finalizar">Finalizar Est√°gio</button>
      `;
      }

      li.innerHTML = `
      <div>
        <span class="font-medium">${nome}</span><br>
        <span class="text-xs text-gray-700">${email}</span><br>
        <span class="text-xs text-gray-700">${telefone}</span>
      </div>
      <div class="flex gap-2 items-center">
        ${botoesHTML}
        <span class="ml-2 text-sm font-medium text-gray-700">${status}</span>
      </div>
    `;

      // üîπ Eventos
      const btnAceitar = li.querySelector(".btn-aceitar");
      if (btnAceitar) {
        btnAceitar.addEventListener("click", async () => {
          try {
            const endpoint =
                    status === "ACEITA"
                            ? `http://localhost:8081/api/coordenador/${id}/ativar`
                            : `http://localhost:8081/api/coordenador/${id}/aceitar`;

            const resp = await fetch(endpoint, { method: "POST" });
            if (resp.ok) {
              alert(status === "ACEITA" ? "Est√°gio iniciado!" : "Candidato aceito!");
              carregarCandidatos(ofertaId);
            } else {
              alert("Erro ao aceitar/ativar candidato");
            }
          } catch (e) {
            console.error(e);
            alert("Erro de conex√£o com o servidor");
          }
        });
      }

      const btnRecusar = li.querySelector(".btn-recusar");
      if (btnRecusar) {
        btnRecusar.addEventListener("click", async () => {
          try {
            const resp = await fetch(`http://localhost:8081/api/coordenador/${id}/recusar`, {
              method: "POST"
            });
            if (resp.ok) {
              alert("Candidato recusado!");
              carregarCandidatos(ofertaId);
            } else {
              alert("Erro ao recusar candidato");
            }
          } catch (e) {
            console.error(e);
            alert("Erro de conex√£o com o servidor");
          }
        });
      }

      const btnFinalizar = li.querySelector(".btn-finalizar");
      if (btnFinalizar) {
        btnFinalizar.addEventListener("click", async () => {
          try {
            await fetch(`http://localhost:8081/api/coordenador/${c.id}/finalizar`, { method: 'POST' });
            if (resp.ok) {
              alert("Est√°gio finalizado!");
              carregarCandidatos(ofertaId);
            } else {
              alert("Erro ao finalizar est√°gio");
            }
          } catch (e) {
            console.error(e);
            alert("Erro de conex√£o com o servidor");
          }
        });
      }

      // üîπ Adiciona na lista correta
      if (status === "INSCRITO") ulInscritos.appendChild(li);
      else if (status === "ACEITA") ulAceitos.appendChild(li);
      else if (status === "ATIVO") ulAtivos.appendChild(li);
      else if (status === "RECUSADA" || status === "RECUSADO") ulRecusados.appendChild(li);
      else if (status === "FINALIZADO") ulFinalizados.appendChild(li);
    });
  }


  /* Render gerenciar (sincroniza conte√∫do de cards com dados) */
function renderGerenciar(){
  // Gerenciar cards atualiza contadores (j√° feito em renderOffers) ‚Äî manter coer√™ncia
  renderOffers();
}

/* Abrir modal para avalia√ß√£o (usado ao finalizar est√°gio na lista de ativos) */
const modalAvaliacao = document.getElementById('modal-avaliacao');
const empresaAvaliar = document.getElementById('empresa-avaliar');
const notaAvaliacao = document.getElementById('nota-avaliacao');
const comentarioAvaliacao = document.getElementById('comentario-avaliacao');
let avaliacaoContext = null; // { ofertaId, alunoNome }

function openAvaliacao(ofertaId, alunoNome){
  const of = offers.find(o=>o.id===ofertaId);
  if(!of) return;
  empresaAvaliar.textContent = `${of.empresa} ‚Äî Avalia√ß√£o por ${alunoNome}`;
  notaAvaliacao.value = '5';
  comentarioAvaliacao.value = '';
  avaliacaoContext = { ofertaId, alunoNome, empresa: of.empresa };
  modalAvaliacao.classList.remove('hidden'); modalAvaliacao.classList.add('flex');
}
function closeAvaliacao(){
  modalAvaliacao.classList.add('hidden'); modalAvaliacao.classList.remove('flex');
}

/* Envio de avalia√ß√£o: armazena em `avaliacoes` */
document.getElementById('enviar-avaliacao').addEventListener('click', ()=>{
  if(!avaliacaoContext) return;
  const novo = {
    id: 'a' + Date.now(),
    aluno: avaliacaoContext.alunoNome,
    empresa: avaliacaoContext.empresa,
    notaAluno: Number(notaAvaliacao.value),
    comentarioAluno: comentarioAvaliacao.value,
    // Empresa pode avaliar depois; por ora vazio
    notaEmpresa: null,
    comentarioEmpresa: null
  };
  avaliacoes.unshift(novo);
  closeAvaliacao();
  renderAvaliacoes();
  alert('Avalia√ß√£o enviada (mock).');
  avaliacaoContext = null;
});

/* cancelar avaliacao */
document.getElementById('cancelar-avaliacao').addEventListener('click', closeAvaliacao);

/* ---------- Eventos globais (clicks) ---------- */
document.body.addEventListener('click', function(e){
  // Ver detalhes (Ofertas / Gerenciar)
  const verBtn = e.target.closest('.btn-ver-detalhes') || e.target.closest('.btn-ver-gerenciar');
  if(verBtn){
    console.log('Bot√£o de ver detalhes clicado! ID:', verBtn.dataset.id);
    const id = verBtn.dataset.id;
    openDetalhes(id);
    return;
  }

  // Excluir oferta
  const exBtn = e.target.closest('.btn-excluir');
  if(exBtn){
    const id = exBtn.dataset.id;
    if(confirm('Deseja excluir esta oferta? Esta a√ß√£o remover√° a oferta de todas as abas.')){
      offers = offers.filter(o=>o.id !== id);
      renderOffers();
      renderAvaliacoes();
    }
    return;
  }

  // Fechar modal detalhes
  if(e.target === btnFecharDetalhes || e.target === btnFecharDetalhes2 || e.target === document.getElementById('btn-fechar-detalhes')){
    closeDetalhes();
  }

  // Fechar clicando fora do conte√∫do do modal (opcional)
  if(e.target === modalDetalhes) closeDetalhes();
  if(e.target === modalAvaliacao) closeAvaliacao();
});

/* ---------- Criar oferta via bot√£o (s√≥ front) ---------- */
document.getElementById('btn-adicionar-oferta').addEventListener('click', ()=>{
  const titulo = prompt('T√≠tulo (empresa) da nova oferta:', 'Nova Empresa');
  const desc = prompt('Descri√ß√£o da nova oferta:', 'Descri√ß√£o do est√°gio...');
  if(titulo && desc){
    const novo = {
      id: 'o' + Date.now(),
      empresa: titulo,
      descricao: desc,
      candidatos: []
    };
    offers.unshift(novo);
    renderOffers();
    alert('Oferta adicionada (mock).');
  }
});

/* ---------- Finalizar est√°gio / Avaliar (na interface Gerenciar - Ativos) ----------
   We will provide buttons inside the Gerenciar card area to open evaluation for ativos.
   Also implement Finalizar->Avaliar behavior for items shown in the card area.
-------------------------------------------------------------------------- */

function renderOffersWithActiveControls(){
  // similar to renderOffers but after placing cards, attach controls for Finalizar/Avaliar inside Gerenciar modal lists
  document.querySelectorAll('#gerenciar-ofertas-grid > div').forEach(card => {
    const ofertaId = card.dataset.ofertaId;
    const of = offers.find(o => o.id === ofertaId);
    if(!of) return;

    let existing = card.querySelector('.ativos-controls');
    if(existing) existing.remove();

    const container = document.createElement('div');
    container.className = 'ativos-controls mt-3 space-y-2';
    of.candidatos.filter(c => c.status==='ativo').forEach(c => {
      const row = document.createElement('div');
      row.className = 'flex items-center justify-between text-sm bg-gray-50 p-2 rounded-md';
      row.innerHTML = `<div class="font-medium">${c.nome}</div>`;
      const actions = document.createElement('div');
      const btnFinalizar = document.createElement('button');
      btnFinalizar.className = 'px-2 py-1 bg-yellow-500 text-white rounded-md text-xs hover:bg-yellow-600';
      btnFinalizar.textContent = 'Finalizar Est√°gio';
      btnFinalizar.addEventListener('click', () => {
        btnFinalizar.remove();
        const btnAvaliar = document.createElement('button');
        btnAvaliar.className = 'px-2 py-1 bg-blue-500 text-white rounded-md text-xs hover:bg-blue-600 ml-2';
        btnAvaliar.textContent = 'Avaliar';
        btnAvaliar.addEventListener('click', ()=> openAvaliacao(ofertaId, c.nome));
        actions.appendChild(btnAvaliar);
      });
      actions.appendChild(btnFinalizar);
      row.appendChild(actions);
      container.appendChild(row);
    });
    card.appendChild(container);
  });
  // We also want to add Finalizar/Avaliar buttons on the gerenciar cards display for ativos list
  // find gerenciar cards created by renderOffers (same DOM)
  document.querySelectorAll('#gerenciar-ofertas-grid > div').forEach(card=>{
    const ofertaId = card.dataset.ofertaId;
    const of = offers.find(o=>o.id === ofertaId);
    if(!of) return;

    // find existing area and append a small active list with buttons (below the counters)
    // remove previous area if exists
    let existing = card.querySelector('.ativos-controls');
    if(existing) existing.remove();

    const ativos = of.candidatos.filter(c=>c.status==='ativo');
    const container = document.createElement('div');
    container.className = 'ativos-controls mt-3 space-y-2';
    ativos.slice(0,3).forEach(c=>{
      const row = document.createElement('div');
      row.className = 'flex items-center justify-between text-sm bg-gray-50 p-2 rounded-md';
      row.innerHTML = `<div class="font-medium">${c.nome}</div>`;
      const actions = document.createElement('div');
      const btnFinalizar = document.createElement('button');
      btnFinalizar.className = 'px-2 py-1 bg-yellow-500 text-white rounded-md text-xs hover:bg-yellow-600';
      btnFinalizar.textContent = 'Finalizar Est√°gio';
      btnFinalizar.addEventListener('click', ()=>{
        // change UI: remove finalizar and show avaliar
        btnFinalizar.remove();
        const btnAvaliar = document.createElement('button');
        btnAvaliar.className = 'px-2 py-1 bg-blue-500 text-white rounded-md text-xs hover:bg-blue-600 ml-2';
        btnAvaliar.textContent = 'Avaliar';
        btnAvaliar.addEventListener('click', ()=>{
          openAvaliacao(ofertaId, c.nome);
        });
        actions.appendChild(btnAvaliar);
      });
      actions.appendChild(btnFinalizar);
      row.appendChild(actions);
      container.appendChild(row);
    });
    card.appendChild(container);
  });
}

/* ---------- Utils: render inicial e atualiza√ß√µes ---------- */
function initAll(){
  renderOffers();
  renderAvaliacoes();
  renderOffersWithActiveControls();
}

/* Re-render helper after changes */
function fullRefresh(){
  renderOffers();
  renderOffersWithActiveControls();
  renderAvaliacoes();
}

/* ---------- Gerenciar via modal: keep synchronized with model ----------
   When modal buttons call updateCandidateStatus, we re-open modal and re-render.
-------------------------------------------------------------------------- */

/* ---------- Form perfil (apenas UI) ---------- */
document.getElementById('form-perfil').addEventListener('submit', function(e){
  e.preventDefault();
  alert('Perfil atualizado (mock).');
});

/* ---------- Tabs ---------- */
const tabs = document.querySelectorAll('.tab-button');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab=>{
  tab.addEventListener('click', ()=>{
    tabs.forEach(t=>t.classList.remove('bg-primary','text-white'));
    tabs.forEach(t=>t.classList.add('text-gray-600','hover:text-primary','hover:bg-blue-50'));
    tab.classList.add('bg-primary','text-white');
    tab.classList.remove('text-gray-600','hover:text-primary','hover:bg-blue-50');
    const target = tab.id.replace('tab-','content-');
    contents.forEach(c=>c.classList.add('hidden'));
    document.getElementById(target).classList.remove('hidden');
  });
});

/* ---------- Inicializa√ß√£o ---------- */
initAll();

/* ---------- Quando abrir modal detalhes novamente, recriar os controls que permitem ao coordenador aceitar/recusar ---------- */
/* J√° feito via openDetalhes + updateCandidateStatus -> re-render */

/* ---------- Garantir atualiza√ß√£o dos controles de ativos quando h√° mudan√ßas ---------- */
const observer = new MutationObserver(() => {
  // small debounce
  setTimeout(()=> renderOffersWithActiveControls(), 50);
});
observer.observe(gerenciarGrid, { childList: true, subtree: true });

document.getElementById("form-cadastro").addEventListener("submit", async (e) => {
    e.preventDefault(); // impede recarregar a p√°gina

    // pegar valores dos campos
    const coordenador = {
        nome: document.getElementById("cadastro-nome").value,
        cpf: document.getElementById("cadastro-cpf").value,
        senha: document.getElementById("cadastro-senha").value,
        email: document.getElementById("cadastro-email").value,
        telefone: document.getElementById("cadastro-telefone").value,
        endereco: document.getElementById("cadastro-endereco").value
    };

    console.log("Enviando dados:", coordenador);

    try {
        const response = await fetch("http://localhost:8081/api/coordenador/cadastrar", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(coordenador)
        });

        if (!response.ok) {
            throw new Error("Falha ao cadastrar coordenador");
        }

        const data = await response.json();
        console.log("Coordenador cadastrado com sucesso!", data);

        alert("Coordenador cadastrado com sucesso!");

        // limpa o formul√°rio
        document.getElementById("form-cadastro").reset();

    } catch (error) {
        console.error(error);
        alert("Erro ao cadastrar. Verifique os dados.");
    }
});
</script>
</body>
</html>